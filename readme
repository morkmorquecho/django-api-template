# ğŸ›ï¸ ColecciÃ³n Lorenza - API REST

API REST completa para e-commerce con sistema de blog integrado, construida con Django REST Framework.

## ğŸ“‹ Tabla de Contenidos

- [Stack TecnolÃ³gico](#-stack-tecnolÃ³gico)
- [Requisitos Previos](#-requisitos-previos)
- [InstalaciÃ³n](#-instalaciÃ³n)
- [ConfiguraciÃ³n](#ï¸-configuraciÃ³n)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [Comandos Ãštiles](#-comandos-Ãºtiles)
- [CaracterÃ­sticas Principales](#-caracterÃ­sticas-principales)
- [DocumentaciÃ³n de la API](#-documentaciÃ³n-de-la-api)
- [Deployment](#-deployment)

## ğŸš€ Stack TecnolÃ³gico

### Backend
- **Django** 5.2.10
- **Django REST Framework** - API REST
- **Simple JWT** - AutenticaciÃ³n JWT
- **dj-rest-auth** - Endpoints de autenticaciÃ³n
- **django-allauth** - AutenticaciÃ³n social (Google)

### Base de Datos
- **SQL Server** (mssql-django)
- Soporte para autenticaciÃ³n Windows y estÃ¡ndar

### DocumentaciÃ³n y Monitoreo
- **drf-spectacular** - DocumentaciÃ³n Swagger/OpenAPI
- **Sentry** - Monitoreo de errores en producciÃ³n
- **Rich** - Logging mejorado en consola

### Otras Herramientas
- **django-cors-headers** - Manejo de CORS
- **python-decouple** - GestiÃ³n de variables de entorno
- **Redis** (opcional) - Cache y rate limiting

## ğŸ“¦ Requisitos Previos

- Python 3.13+
- pipenv (para gestiÃ³n de dependencias)
- SQL Server (o cualquier base de datos compatible)
- ODBC Driver 17 for SQL Server

### Instalar pipenv

```bash
pip install pipenv
```

## ğŸ”§ InstalaciÃ³n

### 1. Clonar el repositorio

```bash
git clone <url-del-repositorio>
cd template_django
```

### 2. Instalar dependencias

```bash
pipenv install
```

### 3. Activar el entorno virtual

```bash
pipenv shell
```

### 4. Configurar variables de entorno

Crea un archivo `.env` en la raÃ­z del proyecto (ver secciÃ³n [ConfiguraciÃ³n](#ï¸-configuraciÃ³n)).

### 5. Ejecutar migraciones

```bash
pipenv run mk  # Crear migraciones
pipenv run mi  # Aplicar migraciones
```

### 6. Crear superusuario

```bash
pipenv run su
```

### 7. Ejecutar el servidor

```bash
pipenv run r
```

El servidor estarÃ¡ disponible en `http://localhost:8000`

## âš™ï¸ ConfiguraciÃ³n

### Variables de Entorno

Crea un archivo `.env` en la raÃ­z del proyecto con las siguientes variables:

```env
# ==================== CONFIGURACIÃ“N GENERAL ====================
DEBUG=True
SECRET_KEY=tu-secret-key-aqui
ACTIVE_RATES=False  # True para activar rate limiting estricto
CACHES_REDIS=False  # True para usar Redis como cache

# ==================== BASE DE DATOS ====================
ENGINE_DB=mssql
NAME_DB=nombre_base_datos
HOST_DB=localhost\SQLEXPRESS
PORT_DB=1433

# Para autenticaciÃ³n SQL Server estÃ¡ndar (descomenta si no usas Windows Auth)
# USER_DB=tu_usuario
# PASSWORD_DB=tu_contraseÃ±a

# ==================== PAGINACIÃ“N ====================
PAGINATION_LIMIT=15

# ==================== EMAIL (Gmail SMTP) ====================
EMAIL_HOST_USER=tu-email@gmail.com
EMAIL_HOST_PASSWORD=tu-app-password-aqui  # ContraseÃ±a de aplicaciÃ³n de Gmail

# ==================== CORS ====================
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173

# ==================== AUTENTICACIÃ“N SOCIAL ====================
# Google OAuth
ID_GOOGLE_CLIENT=tu-client-id.apps.googleusercontent.com
SECRET_GOOGLE_CLIENT=tu-secret-client
GOOGLE_CALLBACK=http://localhost:8000/auth/google/callback

# Facebook OAuth (opcional)
FACEBOOK_APP_ID=
FACEBOOK_APP_SECRET=

# ==================== SENTRY (ProducciÃ³n) ====================
SDK_SENTRY=https://tu-dsn@sentry.io/proyecto

# ==================== DOCUMENTACIÃ“N SWAGGER ====================
TITLE_SWAGGER=API ColecciÃ³n Lorenza
DESCRIPTION_SWAGGER=API REST para e-commerce con gestiÃ³n de productos, Ã³rdenes y blog
```

### Notas de ConfiguraciÃ³n

#### Base de Datos

**OpciÃ³n 1: AutenticaciÃ³n Windows (SQL Server)**
```env
ENGINE_DB=mssql
NAME_DB=config('NAME_DB')
HOST_DB=DESKTOP-Q020TPN\SQLEXPRESS
```

**OpciÃ³n 2: AutenticaciÃ³n SQL Server**
Descomenta las lÃ­neas en `settings.py` para usar autenticaciÃ³n estÃ¡ndar:
```python
DATABASES = {
    'default': {
        'ENGINE': config('DB_ENGINE'),
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST'),
        'PORT': config('DB_PORT', cast=int),
    }
}
```

#### Email (Gmail)

Para usar Gmail necesitas generar una **contraseÃ±a de aplicaciÃ³n**:
1. Ir a https://myaccount.google.com/security
2. Activar verificaciÃ³n en 2 pasos
3. Generar contraseÃ±a de aplicaciÃ³n
4. Usar esa contraseÃ±a en `EMAIL_HOST_PASSWORD`

#### Redis (Opcional)

Si quieres usar Redis para cache:
```env
CACHES_REDIS=True
REDIS_HOST=localhost
REDIS_PORT=6379
```

## ğŸ“ Estructura del Proyecto

```
django-template/
â”œâ”€â”€ config/                  # ConfiguraciÃ³n del proyecto
â”‚   â”œâ”€â”€ settings.py         # ConfiguraciÃ³n principal
â”‚   â”œâ”€â”€ urls.py            # URLs principales
â”‚   â”œâ”€â”€ wsgi.py            # WSGI para deployment
â”‚   â”œâ”€â”€ renderers.py       # Renderizadores personalizados
â”‚   â””â”€â”€ throttling.py      # Rate limiting personalizado
â”‚
â”œâ”€â”€ users/                  # App de usuarios
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ serializers.py
â”‚   â”œâ”€â”€ views.py
â”‚   â””â”€â”€ urls.py
â”‚
â”œâ”€â”€ blog/                   # App de blog
â”œâ”€â”€ orders/                 # App de Ã³rdenes
â”œâ”€â”€ reviews/                # App de reseÃ±as
â”œâ”€â”€ pieces/                 # App de piezas/productos
â”œâ”€â”€ core/                   # Utilidades compartidas
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ exceptions.py  # Manejo de excepciones
â”‚
â”œâ”€â”€ templates/              # Templates de email
â”œâ”€â”€ media/                  # Archivos multimedia
â”œâ”€â”€ staticfiles/           # Archivos estÃ¡ticos
â”œâ”€â”€ logs/                   # Logs de la aplicaciÃ³n
â”‚   â”œâ”€â”€ django.log
â”‚   â””â”€â”€ errors.log
â”‚
â”œâ”€â”€ Pipfile                # Dependencias
â”œâ”€â”€ Pipfile.lock
â”œâ”€â”€ manage.py
â”œâ”€â”€ .env                   # Variables de entorno (no incluir en git)
â””â”€â”€ README.md
```

## ğŸ¯ Comandos Ãštiles

El proyecto incluye scripts de pipenv para facilitar el desarrollo:

```bash
# Servidor de desarrollo
pipenv run r

# Migraciones
pipenv run mk              # Crear migraciones
pipenv run mi              # Aplicar migraciones

# GestiÃ³n de usuarios
pipenv run su              # Crear superusuario

# Desarrollo
pipenv run sh              # Django shell
pipenv run test            # Ejecutar tests
pipenv run st <nombre>     # Crear nueva app

# Mantenimiento
pipenv run clearsessions   # Limpiar sesiones expiradas

# Comando directo de Django
pipenv run django <comando>
```

## âœ¨ CaracterÃ­sticas Principales

### AutenticaciÃ³n y Seguridad

- âœ… **JWT (JSON Web Tokens)** con refresh tokens
- âœ… **AutenticaciÃ³n social** con Google OAuth
- âœ… **VerificaciÃ³n de email** obligatoria
- âœ… **Rate limiting** configurable por endpoint
- âœ… **CORS** configurado para frontend
- âœ… **Blacklist de tokens** JWT

### API REST

- âœ… **PaginaciÃ³n automÃ¡tica** (15 items por defecto)
- âœ… **DocumentaciÃ³n Swagger/OpenAPI** en `/api/schema/swagger-ui/`
- âœ… **Respuestas estandarizadas** con renderer personalizado
- âœ… **Manejo de excepciones** centralizado
- âœ… **Throttling por usuario y endpoint**

### Logging y Monitoreo

- âœ… **Logs enriquecidos** con Rich en consola
- âœ… **Logs rotativos** en archivos (15MB mÃ¡x)
- âœ… **Sentry** para monitoreo en producciÃ³n
- âœ… **Logs separados** para errores

### Base de Datos

- âœ… **SQL Server** con soporte Windows Auth
- âœ… **Migraciones automÃ¡ticas**
- âœ… **ORM de Django**

### MÃ³dulos del Sistema

- **Users** - GestiÃ³n de usuarios y perfiles
- **Blog** - Sistema de publicaciones
- **Core** - Utilidades compartidas

## ğŸ“š DocumentaciÃ³n de la API

### Swagger UI

La documentaciÃ³n interactiva de la API estÃ¡ disponible en:

```
http://localhost:8000/api/schema/swagger-ui/
```

### Endpoints Principales

#### AutenticaciÃ³n

```
POST   /api/auth/register/                 # Registro de usuario
POST   /api/auth/login/                    # Login (JWT)
POST   /api/auth/logout/                   # Logout
POST   /api/auth/token/refresh/            # Refrescar token
POST   /api/auth/oauth/google/             # Login con Google
```

#### Rate Limits

Los lÃ­mites de rate limiting dependen de `ACTIVE_RATES`:

**Desarrollo** (`ACTIVE_RATES=False`):
- Usuarios anÃ³nimos: 9,935 req/hora
- Usuarios autenticados: 99,500 req/hora

**ProducciÃ³n** (`ACTIVE_RATES=True`):
- Usuarios anÃ³nimos: 35 req/hora
- Usuarios autenticados: 500 req/hora
- Login: 5 req/hora
- Registro: 3 req/hora
- Endpoints sensibles: 5 req/hora
- Burst: 30 req/min

### AutenticaciÃ³n

Incluye el token JWT en el header:

```
Authorization: Bearer <tu-access-token>
```

## ğŸš€ Deployment

### PreparaciÃ³n para ProducciÃ³n

1. **Variables de entorno**

```env
DEBUG=False
SECRET_KEY=<genera-una-clave-segura>
ACTIVE_RATES=True
ALLOWED_HOSTS=tu-dominio.com
```

2. **Seguridad SSL**

Cuando `DEBUG=False`, se activan automÃ¡ticamente:
- HTTPS redirect
- HSTS
- Secure cookies

3. **Archivos estÃ¡ticos**

```bash
python manage.py collectstatic
```

4. **Sentry**

Configura `SDK_SENTRY` con tu DSN de Sentry.

### Checklist de Deployment

- [ ] `DEBUG=False`
- [ ] `SECRET_KEY` Ãºnico y seguro
- [ ] Base de datos de producciÃ³n configurada
- [ ] `ALLOWED_HOSTS` configurado
- [ ] Variables de entorno seguras
- [ ] Sentry configurado
- [ ] Redis configurado (recomendado)
- [ ] Archivos estÃ¡ticos servidos correctamente
- [ ] HTTPS configurado
- [ ] Backups de base de datos programados
- [ ] Logs monitoreados

### Servidores Recomendados

- **Web Server**: Gunicorn + Nginx
- **Base de datos**: SQL Server (Azure SQL, AWS RDS)
- **Cache**: Redis Cloud
- **Hosting**: Azure, AWS, DigitalOcean, Railway

## ğŸ“ Notas Adicionales

### Desarrollo

- El proyecto usa **Rich** para logs coloridos en desarrollo
- Los logs se guardan en `logs/django.log` y `logs/errors.log`
- El proyecto usa **pipenv** para gestiÃ³n de dependencias


